var E="https://cdn.jsdelivr.net/npm/panzoom@9.4.3/+esm";function b(){return document.documentElement.dataset.scheme==="dark"?"dark":"light"}function v(o,t){let i=t==="light",a=i?o.lightTheme??"default":o.darkTheme??"dark",n=i?o.lightThemeVariables??{}:o.darkThemeVariables??{};return{theme:a,themeVariables:{...n,...o.transparentBackground?{background:"transparent"}:{}}}}function k(o){let t={startOnLoad:!1,securityLevel:o.securityLevel??"strict",look:o.look??"classic",flowchart:{htmlLabels:o.htmlLabels??!0,useMaxWidth:!0},gantt:{useWidth:800}},i=["maxTextSize","maxEdges","fontSize","fontFamily","curve","logLevel"];for(let a of i)o[a]!=null&&(t[a]=o[a]);return t}function y(o,t,i){let{theme:a,themeVariables:n}=t[o];mermaid.initialize({...i,theme:a,...Object.keys(n).length&&{themeVariables:n}})}async function L(o){let t=document.createElement("div");t.className="mermaid-offscreen",document.body.appendChild(t);let i=o.map(n=>{let c=document.createElement("pre");return c.innerHTML=n,t.appendChild(c),c});await mermaid.run({nodes:i});let a=i.map(n=>n.innerHTML);return t.remove(),a}function M(o){o.forEach((t,i)=>{let a=document.createElement("div");a.className="mermaid-wrapper",t.parentNode.insertBefore(a,t),a.appendChild(t),a.insertAdjacentHTML("beforeend",`<div class="mermaid-toolbar"><button data-idx="${i}" title="Open fullscreen with pan/zoom">\u26F6 Expand</button></div>`)})}function w(o){let t=document.getElementById("mermaid-modal"),i=document.getElementById("mermaid-modal-body"),a=document.getElementById("mermaid-modal-content"),n=null,c=null,h=async()=>(c||(c=(await import(E)).default),c),g=()=>{let s=a.querySelector(".mermaid-panzoom-container");if(!n||!s)return;let e=+(s.dataset.nativeWidth??0),r=+(s.dataset.nativeHeight??0),d=a.getBoundingClientRect(),m=Math.min((d.width-60)/e,(d.height-60)/r);n.zoomAbs(0,0,m),n.moveTo((d.width-e*m)/2,(d.height-r*m)/2)},l=()=>{t.classList.remove("active"),document.body.style.overflow="",n?.dispose(),n=null,a.innerHTML=""},p=async s=>{let e=o[s].querySelector("svg");if(!e)return;let r=e.cloneNode(!0),d=e.getAttribute("viewBox"),[m,f]=d?d.split(/[\s,]+/).slice(2).map(Number):[e.getBoundingClientRect().width||800,e.getBoundingClientRect().height||600];r.setAttribute("width",String(m)),r.setAttribute("height",String(f));let u=document.createElement("div");u.className="mermaid-panzoom-container",u.dataset.nativeWidth=String(m),u.dataset.nativeHeight=String(f),u.appendChild(r),a.innerHTML="",a.appendChild(u),t.classList.add("active"),document.body.style.overflow="hidden";let T=await h();setTimeout(()=>{n=T(u,{maxZoom:10,minZoom:.05,bounds:!1}),g(),u.classList.add("ready")},50)};document.addEventListener("click",s=>{let e=s.target,r=e.closest(".mermaid-toolbar button");if(r)return p(+r.dataset.idx);let d=e.closest(".mermaid-modal-controls button");if(d&&n){let m=d.dataset.zoom,f=i.getBoundingClientRect();m==="fit"?g():m==="0"?(n.moveTo(0,0),n.zoomAbs(0,0,1)):n.smoothZoom(f.width/2,f.height/2,m==="1"?1.5:.67)}}),document.getElementById("mermaid-modal-close").addEventListener("click",l),i.addEventListener("click",s=>{s.target===i&&l()}),document.addEventListener("keydown",s=>{s.key==="Escape"&&t.classList.contains("active")&&l()})}async function C(o){let t=document.querySelectorAll(".mermaid");if(!t.length)return;let i=Array.from(t).map(e=>e.innerHTML),a=i.map(e=>/%%\s*transparent\s*%%/i.test(e)),n={light:[],dark:[]},c={light:v(o,"light"),dark:v(o,"dark")},h=k(o),g=(e,r)=>{a[r]&&e.querySelector("svg")?.style.setProperty("background","transparent")};M(t),w(t);let l=b();y(l,c,h),await mermaid.run({nodes:Array.from(t)}),t.forEach((e,r)=>{e.style.visibility="",n[l][r]=e.innerHTML,g(e,r)});let p=l==="dark"?"light":"dark";(window.requestIdleCallback??(e=>setTimeout(e,1e3)))(()=>{n[p].length||(y(p,c,h),L(i).then(e=>{n[p]=e}))}),window.addEventListener("onColorSchemeChange",async()=>{let e=b();n[e].length||(y(e,c,h),n[e]=await L(i)),t.forEach((r,d)=>{r.innerHTML=n[e][d],g(r,d)})})}export{C as initMermaidPage};
